(this.webpackJsonpuno=this.webpackJsonpuno||[]).push([[0],{16:function(e,n,t){},17:function(e,n,t){},21:function(e,n){function t(e){var n=new Error("Cannot find module '"+e+"'");throw n.code="MODULE_NOT_FOUND",n}t.keys=function(){return[]},t.resolve=t,e.exports=t,t.id=21},22:function(e,n,t){"use strict";t.r(n);var c=t(2),r=t.n(c),a=t(11),o=t.n(a),i=(t(16),t(1)),s=t(5),l=t(3),u=(t(17),t(0)),d=function(e){var n=e.card,t=e.hidden,c=void 0!==t&&t,r=e.onClick,a={red:"red",yellow:"orange",blue:"aqua",green:"green",wild:"gray"};return n?Object(u.jsx)("div",{onClick:function(e){!c&&r&&r(e)},style:{backgroundColor:c?"darkgray":"wild"===n.color&&n.assignedColor?a[n.assignedColor]:a[n.color],color:"black"},children:Object(u.jsx)("span",{children:c?"<uno>":n.face})}):Object(u.jsx)(u.Fragment,{})},j=t(4),b=t.n(j),f=t(24);function p(e){for(var n=e.length-1;n>0;n--){var t=Math.floor(Math.random()*(n+1)),c=e[n];e[n]=e[t],e[t]=c}}var O=["blue","red","green","yellow"],h=["0","1","2","3","4","5","6","7","8","9","+2","reverse","skip"],g=["+4","change_color"],m=function(){return[].concat(Object(s.a)(h.concat(h.filter((function(e){return"0"!==e}))).map((function(e){return O.map((function(n){return{color:n,face:e}}))})).flat()),Object(s.a)(g.concat(g,g,g).map((function(e){return{color:"wild",face:e}}))))},v={numDecks:1,playerNames:["player 1","player 2","player 3","player 4"],startingHandSize:7,maxDraws:1,plusTwosStackWithFours:!0,plusTwoSkip:!1,plusFourSkip:!0,unoPenalty:5,jumpIn:!1},y=function(e){return Object(i.a)(Object(i.a)({},v),e)},x=function(e,n){return(e%n+n)%n},k=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=y(e),t=b.a.range(n.numDecks).map(m).flat();p(t);for(var c=n.playerNames.length,r=Object(i.a)({id:Object(f.a)(),deck:b.a.drop(t,c*n.startingHandSize+1),discard:[t[c*n.startingHandSize]],players:n.playerNames.map((function(e,c){return{name:e,cards:b.a.take(b.a.drop(t,c*n.startingHandSize),n.startingHandSize)}})),direction:"forward",currentPlayer:0,currentDraws:0,currentPot:[],winner:void 0,unclaimedUno:void 0},n);g.includes(null!==(a=null===(o=b.a.first(r.discard))||void 0===o?void 0:o.face)&&void 0!==a?a:"");){var a,o,u=w(r.deck),d=Object(l.a)(u,2),j=d[0],O=d[1],h=[].concat(Object(s.a)(O),Object(s.a)(r.discard));p(h),r=D(r,{discard:j,deck:h})}return r},w=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,c=b.a.slice(e,t,t+n),r=[].concat(Object(s.a)(b.a.take(e,t)),Object(s.a)(b.a.drop(e,t+n)));return[r,c]},C=function(e,n,t,c){return e.currentPlayer===c&&(e.currentPot.length>0&&S(e,n,t)||e.currentPot.length<=0&&(n.face===t.face||n.color===t.color||"wild"===n.color&&n.assignedColor===t.color||"wild"===t.color))||e.jumpIn&&t.face===n.face&&t.color===n.color},S=function(e,n,t){return n.face===t.face||e.plusTwosStackWithFours&&("+4"===n.face&&n.assignedColor===t.color&&"+2"===t.face||"+2"===n.face&&"+4"===t.face)},P=function(e,n,t,c){var r=e.players[n],a=w(r.cards,1,t),o=Object(l.a)(a,2),u=o[0],d=o[1],j=b.a.first(d),f=b.a.first(e.discard);return j&&f&&C(e,f,j,n)?(console.log("I can play this!"),"wild"===j.color&&(j.assignedColor=null!==c&&void 0!==c?c:"green"),D(e,Object(i.a)(Object(i.a)({discard:[j].concat(Object(s.a)(e.discard)),players:e.players.map((function(e,t){return t===n?Object(i.a)(Object(i.a)({},e),{},{cards:u}):e})),winner:0===u.length?e.players[n]:void 0,unclaimedUno:1===u.length?n:void 0},N(e,1,n)),F(e,j,u)))):e},D=function(e,n){return Object(i.a)(Object(i.a)(Object(i.a)({},e),n),{},{id:Object(f.a)()})},F=function(e,n,t){switch(n.face){case"skip":return Object(i.a)({},N(e,2));case"reverse":var c="forward"===e.direction?"backward":"forward";return Object(i.a)({direction:c},N(D(e,{direction:c}),2===e.players.length?2:1));case"+4":case"+2":return{currentPot:[].concat(Object(s.a)(e.currentPot),["+2"===n.face?2:4])};default:return{}}},N=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.currentPlayer;return{currentPlayer:x(t+("forward"===e.direction?1:-1)*n,e.players.length),currentDraws:0}},I=t(10),U=t.n(I),E=function(e,n){if(console.log("was tasked to send msg:",n,"to conn:",e),!Array.isArray(e))return console.log("Sending message to ".concat(null===e||void 0===e?void 0:e.peer),n),null===e||void 0===e?void 0:e.send(JSON.stringify(n));e.forEach((function(e){console.log("Sending message to ".concat(e.peer),n),e.send(JSON.stringify(n))}))},W=t(6),T=function(e){var n=e.readOnly,t=e.setGameConfig,r=Object(c.useState)(!1),a=Object(l.a)(r,2),o=a[0],s=a[1],d=Object(c.useState)(!1),f=Object(l.a)(d,2),p=f[0],O=f[1],h=Object(c.useState)({numDecks:{type:"number",default:1,description:"Number of UNO decks to use"},startingHandSize:{type:"number",default:7,description:"Number of cards in the starting hand"},maxDraws:{type:"number",default:1,description:"Amount of card draws one can make before skipping their turn. 0 for infinite"},plusTwosStackWithFours:{type:"boolean",default:!1,description:"Wether a +2 be stacked with a +4 and vice-versa"},plusTwoSkip:{type:"boolean",default:!1,description:"Wether playing a +2 will skip the victim's turn"},plusFourSkip:{type:"boolean",default:!0,description:"Wether playing a +4 will skip the victim's turn"},unoPenalty:{type:"number",default:5,description:"The amount of cards used to penalize who doesn't call UNO on time"},jumpIn:{type:"boolean",default:!1,description:"Wether a player can jump in front of other when they have the exact same card that is in the pile"}}),g=Object(l.a)(h,2),m=g[0],v=g[1];Object(c.useEffect)((function(){s(n||p)}),[n,p]);var y=function(e){var n=e.config,t=e.locked,c=e.value,r=e.onChange;switch(n.type){case"boolean":return Object(u.jsx)("input",{disabled:t,type:"checkbox",checked:c,onChange:r});case"number":return Object(u.jsx)("input",{disabled:t,type:"number",value:c,onChange:r});case"string":return Object(u.jsx)("input",{disabled:t,type:"text",value:c,onChange:r})}};return Object(u.jsxs)("div",{children:[Object.keys(m).map((function(e){var n=m[e];return Object(u.jsxs)("div",{children:[Object(u.jsx)("span",{children:n.description}),Object(u.jsx)(y,{locked:o,config:n,value:n.default,onChange:function(t){"string"===n.type?v((function(c){return Object(i.a)(Object(i.a)({},c),{},Object(W.a)({},e,Object(i.a)(Object(i.a)({},n),{},{default:t.target.value})))})):"number"===n.type?v((function(c){return Object(i.a)(Object(i.a)({},c),{},Object(W.a)({},e,Object(i.a)(Object(i.a)({},n),{},{default:Object(j.toInteger)(t.target.value)})))})):v((function(c){return Object(i.a)(Object(i.a)({},c),{},Object(W.a)({},e,Object(i.a)(Object(i.a)({},n),{},{default:t.target.checked})))}))}})]},e)})),Object(u.jsx)("button",{onClick:function(){O(!0),t(b.a.fromPairs(Object.keys(m).map((function(e){return[e,m[e].default]}))))},children:"Save"})]})};var z=function(){var e=Object(c.useState)(k({})),n=Object(l.a)(e,2),t=n[0],r=n[1],a=Object(c.useState)(void 0),o=Object(l.a)(a,2),j=o[0],f=o[1],p=Object(c.useState)(!1),h=Object(l.a)(p,2),g=h[0],m=h[1],v=Object(c.useState)(""),y=Object(l.a)(v,2),x=y[0],S=y[1],F=Object(c.useState)(!1),I=Object(l.a)(F,2),W=I[0],z=I[1],H=Object(c.useState)(""),A=Object(l.a)(H,2),J=A[0],M=A[1],G=Object(c.useState)([]),L=Object(l.a)(G,2),B=L[0],_=L[1],R=Object(c.useState)([]),q=Object(l.a)(R,2),$=q[0],K=q[1],Q=Object(c.useState)({}),V=Object(l.a)(Q,2),X=V[0],Y=V[1],Z=Object(c.useCallback)((function(e,n){n===t.id?(W&&r(e),n!==e.id&&E(B,{type:"updategame",game:e,currentId:n})):console.error("Ignoring game update",e,"meant for an old version ".concat(n,". current version is ").concat(t.id))}),[B,W,t]);return Object(c.useEffect)((function(){B&&W&&B.forEach((function(e){return E(e,{type:"peerlist",peers:$})}))}),[$,B,W]),Object(c.useEffect)((function(){console.log("Peer list got updated!",$)}),[$]),Object(c.useEffect)((function(){console.log("Connections list got updated!",B)}),[B]),Object(c.useEffect)((function(){return B.forEach((function(e){e.on("data",(function(e){var n,t=(n=e,JSON.parse(n));switch(console.log("Got data",t),t.type){case"newpeer":K((function(e){return console.log("Got new peer ".concat(t.peer,". Current"),e),[].concat(Object(s.a)(e),[t.peer])}));break;case"peerlist":K(t.peers);break;case"updategame":W?Z(t.game,t.currentId):r(t.game),m(!0)}})),e.on("open",(function(){console.log("Opened new conn!"),W||E(e,{type:"newpeer",peer:J})}))})),function(){B.forEach((function(e){e.off("data",void 0),e.off("open",void 0)}))}}),[B,W,J,Z]),Object(u.jsx)("div",{className:"App",children:Object(u.jsx)("header",{className:"App-header",children:g?Object(u.jsx)(u.Fragment,{children:t.winner?Object(u.jsxs)(u.Fragment,{children:[Object(u.jsxs)("span",{children:["We have a winner! Congrats ",t.winner.name]}),W&&Object(u.jsx)("button",{onClick:function(){Z(k(Object(i.a)(Object(i.a)({},X),{},{playerNames:$})),t.id),m(!0)},children:"Restart Game"})]}):Object(u.jsxs)(u.Fragment,{children:[Object(u.jsxs)("div",{style:{display:"flex",flexDirection:"column"},children:[Object(u.jsx)("span",{children:"Top card"}),Object(u.jsx)(d,{card:b.a.first(t.discard)})]}),Object(u.jsx)("div",{style:{display:"flex",flexDirection:"column"},children:Object(u.jsxs)("span",{children:["Deck - ",t.deck.length," cards"]})}),j&&Object(u.jsx)("div",{children:O.map((function(e){return Object(u.jsx)("button",{style:{backgroundColor:e},onClick:function(){Z(j(e),t.id),f(void 0)},children:e},e)}))}),Object(u.jsx)("div",{id:"player-hands",style:{display:"flex",justifyContent:"space-between",width:"70%"},children:t.players.map((function(e,n){return Object(u.jsxs)("div",{style:{display:"flex",flexDirection:"column",padding:"5px"},children:[Object(u.jsx)("span",{style:{color:t.currentPlayer===n?"green":"white"},children:e.name}),Object(u.jsxs)("span",{children:[e.cards.length," cards"]}),e.name===J&&(0===t.currentPot.length||t.currentPlayer!==n?Object(u.jsx)("button",{disabled:t.currentPlayer!==n,onClick:function(){e.name===J&&Z(function(e,n){if(e.currentPlayer!==n)return e;var t=w(e.deck),c=Object(l.a)(t,2),r=c[0],a=c[1];if(a.length>0){var o=D(e,{deck:r,players:e.players.map((function(e,t){return t===n?Object(i.a)(Object(i.a)({},e),{},{cards:[].concat(Object(s.a)(e.cards),Object(s.a)(a))}):e})),currentDraws:e.currentDraws+1}),u=b.a.first(e.discard);return e.maxDraws>=1&&o.currentDraws>=e.maxDraws&&o.players[n].cards.every((function(t){return u&&!C(e,u,t,n)}))?D(o,N(e)):o}return e}(t,n),t.id)},children:"Draw card"}):Object(u.jsxs)("button",{onClick:function(){e.name===J&&Z(function(e,n){var t=w(e.deck,b.a.sum(e.currentPot),0),c=Object(l.a)(t,2),r=c[0],a=c[1];return D(e,Object(i.a)({deck:r,players:e.players.map((function(e,t){return t===n?Object(i.a)(Object(i.a)({},e),{},{cards:[].concat(Object(s.a)(e.cards),Object(s.a)(a))}):e})),currentPot:[]},e.plusFourSkip&&e.currentPot.find((function(e){return 4===e}))||e.plusTwoSkip&&e.currentPot.find((function(e){return 2===e}))?N(e):{}))}(t,n),t.id)},children:["Accept punishment (+",b.a.sum(t.currentPot),")"]})),void 0!==t.unclaimedUno&&e.name===J?Object(u.jsx)("div",{style:t.players[t.unclaimedUno].name===J?{}:{position:"absolute",top:"".concat(90*Math.random(),"%"),left:"".concat(90*Math.random(),"%")},children:Object(u.jsxs)("button",{onClick:function(){Z(function(e,n){if(void 0===e.unclaimedUno)return e;var t=w(e.deck,e.unoPenalty),c=Object(l.a)(t,2),r=c[0],a=c[1];return e.unclaimedUno!==n?D(e,{deck:r,players:e.players.map((function(n,t){return t===e.unclaimedUno?Object(i.a)(Object(i.a)({},n),{},{cards:[].concat(Object(s.a)(n.cards),Object(s.a)(a))}):n})),unclaimedUno:void 0}):D(e,{unclaimedUno:void 0})}(t,t.players.findIndex((function(e){return e.name===J}))),t.id)},children:[t.players[t.unclaimedUno].name===J?"Claim":"Contest"," ","UNO!"]})}):Object(u.jsx)(u.Fragment,{}),Object(u.jsx)("div",{style:{display:"flex",flexDirection:"column",width:"100%",alignItems:"stretch",alignContent:"stretch",justifyContent:"space-between"},children:e.cards.map((function(c,r){return Object(u.jsx)("div",{style:{margin:"3px",cursor:e.name===J?"pointer":"default"},children:Object(u.jsx)(d,{hidden:e.name!==J,onClick:function(){"wild"===c.color?f((function(){return function(e){return P(t,n,r,e)}})):Z(P(t,n,r),t.id)},card:c},r)},r)}))})]},e.name)}))})]})}):Object(u.jsxs)(u.Fragment,{children:[W?Object(u.jsxs)("div",{children:[Object(u.jsx)("button",{onClick:function(){var e=k(Object(i.a)(Object(i.a)({},X),{},{playerNames:$}));Z(e,t.id),m(!0)},children:"Start game"}),Object(u.jsx)(T,{readOnly:!1,setGameConfig:Y})]}):(""!==J||""!==x)&&Object(u.jsx)("span",{children:"Wait for host to start the game"}),Object(u.jsx)("div",{children:Object(u.jsx)("ul",{children:$.map((function(e){return Object(u.jsx)("li",{children:e},e)}))})}),Object(u.jsx)("div",{children:Object(u.jsx)("input",{type:"text",placeholder:"Name",disabled:B.length>0||$.length>0,onChange:function(e){return M(e.target.value)},value:J})}),Object(u.jsx)("hr",{}),W&&Object(u.jsx)("div",{children:Object(u.jsxs)("span",{children:["Waiting for connections. Share your session ID: ",x]})}),!W&&0===B.length&&Object(u.jsxs)(u.Fragment,{children:[Object(u.jsx)("div",{children:Object(u.jsx)("button",{disabled:""===J,onClick:function(){var e=new U.a;e.on("open",(function(n){console.log("Listening in session",n),z(!0),K([J]),S(n),e.on("connection",(function(e){console.log("Received connection!",e),_((function(n){return[].concat(Object(s.a)(n),[e])}))}))}))},children:"Host a session"})}),Object(u.jsx)("span",{children:"or"}),Object(u.jsxs)("div",{children:[Object(u.jsx)("input",{type:"text",placeholder:"Session id",value:x,onChange:function(e){return S(e.target.value)}}),Object(u.jsx)("button",{disabled:""===x||""===J,onClick:function(){console.log("trying to connect to",x);var e=new U.a;e.on("open",(function(n){console.log("I have ID",n);var t=e.connect(x.trim());_((function(e){return[].concat(Object(s.a)(e),[t])}))}))},children:"Join a session"})]})]})]})})})};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var H=function(e){e&&e instanceof Function&&t.e(3).then(t.bind(null,25)).then((function(n){var t=n.getCLS,c=n.getFID,r=n.getFCP,a=n.getLCP,o=n.getTTFB;t(e),c(e),r(e),a(e),o(e)}))};o.a.render(Object(u.jsx)(r.a.StrictMode,{children:Object(u.jsx)(z,{})}),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)})),H()}},[[22,1,2]]]);
//# sourceMappingURL=main.b91e7954.chunk.js.map
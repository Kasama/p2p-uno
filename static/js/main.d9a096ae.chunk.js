(this.webpackJsonpuno=this.webpackJsonpuno||[]).push([[0],{16:function(e,n,t){},17:function(e,n,t){},21:function(e,n){function t(e){var n=new Error("Cannot find module '"+e+"'");throw n.code="MODULE_NOT_FOUND",n}t.keys=function(){return[]},t.resolve=t,e.exports=t,t.id=21},22:function(e,n,t){"use strict";t.r(n);var c=t(2),r=t.n(c),a=t(11),o=t.n(a),i=(t(16),t(1)),s=t(5),u=t(3),l=(t(17),t(0)),d=function(e){var n=e.card,t=e.hidden,c=void 0!==t&&t,r=e.onClick,a={red:"red",yellow:"orange",blue:"aqua",green:"green",wild:"gray"};return n?Object(l.jsx)("div",{onClick:function(e){!c&&r&&r(e)},style:{backgroundColor:c?"darkgray":"wild"===n.color&&n.assignedColor?a[n.assignedColor]:a[n.color],color:"black"},children:Object(l.jsx)("span",{children:c?"<uno>":n.face})}):Object(l.jsx)(l.Fragment,{})},j=t(4),b=t.n(j),f=t(24);function O(e){for(var n=e.length-1;n>0;n--){var t=Math.floor(Math.random()*(n+1)),c=e[n];e[n]=e[t],e[t]=c}}var p=["blue","red","green","yellow"],h=["0","1","2","3","4","5","6","7","8","9","+2","reverse","skip"],g=["+4","change_color"],m=function(){return[].concat(Object(s.a)(h.concat(h.filter((function(e){return"0"!==e}))).map((function(e){return p.map((function(n){return{color:n,face:e}}))})).flat()),Object(s.a)(g.concat(g,g,g).map((function(e){return{color:"wild",face:e}}))))},v={numDecks:1,playerNames:["player 1","player 2","player 3","player 4"],startingHandSize:7,maxDraws:1,plusTwosStackWithFours:!0,plusTwoSkip:!1,plusFourSkip:!0,unoPenalty:5,jumpIn:!0},y=function(e){return Object(i.a)(Object(i.a)({},v),e)},x=function(e,n){return(e%n+n)%n},k=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=y(e),t=b.a.range(n.numDecks).map(m).flat();O(t);var c=n.playerNames.length;return Object(i.a)({id:Object(f.a)(),deck:b.a.drop(t,c*n.startingHandSize+1),discard:[t[c*n.startingHandSize]],players:n.playerNames.map((function(e,c){return{name:e,cards:b.a.take(b.a.drop(t,c*n.startingHandSize),n.startingHandSize)}})),direction:"forward",currentPlayer:0,currentDraws:0,currentPot:[],winner:void 0,unclaimedUno:void 0},n)},w=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,c=b.a.slice(e,t,t+n),r=[].concat(Object(s.a)(b.a.take(e,t)),Object(s.a)(b.a.drop(e,t+n)));return[r,c]},S=function(e,n,t){return e.currentPot.length>0&&("+2"===t.face||"+4"===t.face)&&(t.face===n.face||e.plusTwosStackWithFours&&("wild"===t.color||"wild"===n.color&&t.color===n.assignedColor))||e.currentPot.length<=0&&(n.face===t.face||n.color===t.color||"wild"===n.color&&n.assignedColor===t.color||"wild"===t.color)},C=function(e,n,t,c){if(e.currentPlayer!==n)return e;var r=e.players[n],a=w(r.cards,1,t),o=Object(u.a)(a,2),l=o[0],d=o[1],j=b.a.first(d),f=b.a.first(e.discard);return j&&f&&S(e,f,j)?("wild"===j.color&&(j.assignedColor=null!==c&&void 0!==c?c:"green"),P(e,Object(i.a)(Object(i.a)({discard:[j].concat(Object(s.a)(e.discard)),players:e.players.map((function(e,t){return t===n?Object(i.a)(Object(i.a)({},e),{},{cards:l}):e})),winner:0===l.length?e.players[n]:void 0,unclaimedUno:1===l.length?n:void 0},F(e)),D(e,j,l)))):e},P=function(e,n){return Object(i.a)(Object(i.a)(Object(i.a)({},e),n),{},{id:Object(f.a)()})},D=function(e,n,t){switch(n.face){case"skip":return Object(i.a)({},F(e,2));case"reverse":var c="forward"===e.direction?"backward":"forward";return Object(i.a)({direction:c},F(P(e,{direction:c}),2===e.players.length?2:1));case"+4":case"+2":var r=F(e).currentPlayer;if(e.players[r].cards.some((function(t){return function(e,n,t){return n.face===t.face||e.plusTwosStackWithFours&&("+4"===n.face&&n.assignedColor===t.color&&"+2"===t.face||"+2"===n.face&&"+4"===t.face)}(e,n,t)})))return{currentPot:[].concat(Object(s.a)(e.currentPot),["+2"===n.face?2:4])};var a=w(e.deck,b.a.sum(e.currentPot)+("+2"===n.face?2:4),0),o=Object(u.a)(a,2),l=o[0],d=o[1];return Object(i.a)({deck:l,players:e.players.map((function(n,c){return c===r?Object(i.a)(Object(i.a)({},n),{},{cards:[].concat(Object(s.a)(n.cards),Object(s.a)(d))}):c===e.currentPlayer?Object(i.a)(Object(i.a)({},n),{},{cards:t}):n})),currentPot:[]},"+2"===n.face&&e.plusTwoSkip||"+4"===n.face&&e.plusFourSkip||e.plusFourSkip&&e.currentPot.find((function(e){return 4===e}))||e.plusTwoSkip&&e.currentPot.find((function(e){return 2===e}))?F(e,2):{});default:return{}}},F=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return{currentPlayer:x(e.currentPlayer+("forward"===e.direction?1:-1)*n,e.players.length),currentDraws:0}},N=t(10),T=t.n(N),U=function(e,n){if(console.log("was tasked to send msg:",n,"to conn:",e),!Array.isArray(e))return console.log("Sending message to ".concat(null===e||void 0===e?void 0:e.peer),n),null===e||void 0===e?void 0:e.send(JSON.stringify(n));e.forEach((function(e){console.log("Sending message to ".concat(e.peer),n),e.send(JSON.stringify(n))}))},E=t(6),W=function(e){var n=e.readOnly,t=e.setGameConfig,r=Object(c.useState)(!1),a=Object(u.a)(r,2),o=a[0],s=a[1],d=Object(c.useState)(!1),f=Object(u.a)(d,2),O=f[0],p=f[1],h=Object(c.useState)({numDecks:{type:"number",default:1,description:"Number of UNO decks to use"},startingHandSize:{type:"number",default:7,description:"Number of cards in the starting hand"},maxDraws:{type:"number",default:1,description:"Amount of card draws one can make before skipping their turn. 0 for infinite"},plusTwosStackWithFours:{type:"boolean",default:!1,description:"Wether a +2 be stacked with a +4 and vice-versa"},plusTwoSkip:{type:"boolean",default:!1,description:"Wether playing a +2 will skip the victim's turn"},plusFourSkip:{type:"boolean",default:!0,description:"Wether playing a +4 will skip the victim's turn"},unoPenalty:{type:"number",default:5,description:"The amount of cards used to penalize who doesn't call UNO on time"}}),g=Object(u.a)(h,2),m=g[0],v=g[1];Object(c.useEffect)((function(){s(n||O)}),[n,O]);var y=function(e){var n=e.config,t=e.locked,c=e.value,r=e.onChange;switch(n.type){case"boolean":return Object(l.jsx)("input",{disabled:t,type:"checkbox",checked:c,onChange:r});case"number":return Object(l.jsx)("input",{disabled:t,type:"number",value:c,onChange:r});case"string":return Object(l.jsx)("input",{disabled:t,type:"text",value:c,onChange:r})}};return Object(l.jsxs)("div",{children:[Object.keys(m).map((function(e){var n=m[e];return Object(l.jsxs)("div",{children:[Object(l.jsx)("span",{children:n.description}),Object(l.jsx)(y,{locked:o,config:n,value:n.default,onChange:function(t){"string"===n.type?v((function(c){return Object(i.a)(Object(i.a)({},c),{},Object(E.a)({},e,Object(i.a)(Object(i.a)({},n),{},{default:t.target.value})))})):"number"===n.type?v((function(c){return Object(i.a)(Object(i.a)({},c),{},Object(E.a)({},e,Object(i.a)(Object(i.a)({},n),{},{default:Object(j.toInteger)(t.target.value)})))})):v((function(c){return Object(i.a)(Object(i.a)({},c),{},Object(E.a)({},e,Object(i.a)(Object(i.a)({},n),{},{default:t.target.checked})))}))}})]},e)})),Object(l.jsx)("button",{onClick:function(){p(!0),t(b.a.fromPairs(Object.keys(m).map((function(e){return[e,m[e].default]}))))},children:"Save"})]})};var I=function(){var e=Object(c.useState)(k({})),n=Object(u.a)(e,2),t=n[0],r=n[1],a=Object(c.useState)(void 0),o=Object(u.a)(a,2),j=o[0],f=o[1],O=Object(c.useState)(!1),h=Object(u.a)(O,2),g=h[0],m=h[1],v=Object(c.useState)(""),y=Object(u.a)(v,2),x=y[0],D=y[1],N=Object(c.useState)(!1),E=Object(u.a)(N,2),I=E[0],z=E[1],H=Object(c.useState)(""),J=Object(u.a)(H,2),A=J[0],G=J[1],L=Object(c.useState)([]),M=Object(u.a)(L,2),B=M[0],_=M[1],q=Object(c.useState)([]),R=Object(u.a)(q,2),$=R[0],K=R[1],Q=Object(c.useState)({}),V=Object(u.a)(Q,2),X=V[0],Y=V[1],Z=Object(c.useCallback)((function(e,n){n===t.id?(I&&r(e),n!==e.id&&U(B,{type:"updategame",game:e,currentId:n})):console.error("Ignoring game update",e,"meant for an old version ".concat(n,". current version is ").concat(t.id))}),[B,I,t]);return Object(c.useEffect)((function(){B&&I&&B.forEach((function(e){return U(e,{type:"peerlist",peers:$})}))}),[$,B,I]),Object(c.useEffect)((function(){console.log("Peer list got updated!",$)}),[$]),Object(c.useEffect)((function(){console.log("Connections list got updated!",B)}),[B]),Object(c.useEffect)((function(){return B.forEach((function(e){e.on("data",(function(e){var n,t=(n=e,JSON.parse(n));switch(console.log("Got data",t),t.type){case"newpeer":K((function(e){return console.log("Got new peer ".concat(t.peer,". Current"),e),[].concat(Object(s.a)(e),[t.peer])}));break;case"peerlist":K(t.peers);break;case"updategame":I?Z(t.game,t.currentId):r(t.game),m(!0)}})),e.on("open",(function(){console.log("Opened new conn!"),I||U(e,{type:"newpeer",peer:A})}))})),function(){B.forEach((function(e){e.off("data",void 0),e.off("open",void 0)}))}}),[B,I,A,Z]),Object(l.jsx)("div",{className:"App",children:Object(l.jsx)("header",{className:"App-header",children:g?Object(l.jsx)(l.Fragment,{children:t.winner?Object(l.jsxs)("span",{children:["We have a winner! Congrats ",t.winner.name]}):Object(l.jsxs)(l.Fragment,{children:[j&&Object(l.jsx)("div",{children:p.map((function(e){return Object(l.jsx)("button",{style:{backgroundColor:e},onClick:function(){Z(j(e),t.id),f(void 0)},children:e},e)}))}),Object(l.jsxs)("div",{id:"player-hands",style:{display:"flex",justifyContent:"space-between"},children:[t.players.map((function(e,n){return Object(l.jsxs)("div",{style:{display:"flex",flexDirection:"column"},children:[Object(l.jsx)("span",{style:{color:t.currentPlayer===n?"green":"white"},children:e.name}),Object(l.jsx)("span",{children:e.cards.length}),Object(l.jsx)("ul",{children:e.cards.map((function(c,r){return Object(l.jsx)("div",{style:{margin:"3px"},children:Object(l.jsx)(d,{hidden:e.name!==A,onClick:function(){"wild"===c.color?f((function(){return function(e){return C(t,n,r,e)}})):Z(C(t,n,r),t.id)},card:c},r)},r)}))}),e.name===A&&Object(l.jsx)("button",{onClick:function(){e.name===A&&Z(function(e,n){if(e.currentPlayer!==n)return e;var t=w(e.deck),c=Object(u.a)(t,2),r=c[0],a=c[1];if(a.length>0){var o=P(e,{deck:r,players:e.players.map((function(e,t){return t===n?Object(i.a)(Object(i.a)({},e),{},{cards:[].concat(Object(s.a)(e.cards),Object(s.a)(a))}):e})),currentDraws:e.currentDraws+1}),l=b.a.first(e.discard);return e.maxDraws>=1&&o.currentDraws>=e.maxDraws&&o.players[n].cards.every((function(n){return l&&!S(e,l,n)}))?P(o,F(e)):o}return e}(t,n),t.id)},children:"Take card"})]},e.name)})),Object(l.jsxs)("div",{style:{display:"flex",flexDirection:"column"},children:[Object(l.jsx)("span",{children:"Top card"}),Object(l.jsx)(d,{card:b.a.first(t.discard)})]}),Object(l.jsxs)("div",{style:{display:"flex",flexDirection:"column"},children:[Object(l.jsxs)("span",{children:["POT: ",JSON.stringify(t.currentPot)," ="," ",b.a.sum(t.currentPot)]}),Object(l.jsxs)("span",{children:["Deck - ",t.deck.length]})]})]}),void 0!==t.unclaimedUno?Object(l.jsx)("div",{children:Object(l.jsxs)("button",{onClick:function(){Z(function(e,n){if(void 0===e.unclaimedUno)return e;var t=w(e.deck,e.unoPenalty),c=Object(u.a)(t,2),r=c[0],a=c[1];return e.unclaimedUno!==n?P(e,{deck:r,players:e.players.map((function(n,t){return t===e.unclaimedUno?Object(i.a)(Object(i.a)({},n),{},{cards:[].concat(Object(s.a)(n.cards),Object(s.a)(a))}):n})),unclaimedUno:void 0}):P(e,{unclaimedUno:void 0})}(t,t.players.findIndex((function(e){return e.name===A}))),t.id)},children:[t.players[t.unclaimedUno].name===A?"Claim":"Contest"," ","UNO!"]})}):Object(l.jsx)(l.Fragment,{})]})}):Object(l.jsxs)(l.Fragment,{children:[I?Object(l.jsxs)("div",{children:[Object(l.jsx)("button",{onClick:function(){var e=k(Object(i.a)(Object(i.a)({},X),{},{playerNames:$}));Z(e,t.id),m(!0)},children:"Start game"}),Object(l.jsx)(W,{readOnly:!1,setGameConfig:Y})]}):(""!==A||""!==x)&&Object(l.jsx)("span",{children:"Wait for host to start the game"}),Object(l.jsx)("div",{children:Object(l.jsx)("ul",{children:$.map((function(e){return Object(l.jsx)("li",{children:e},e)}))})}),Object(l.jsx)("div",{children:Object(l.jsx)("input",{type:"text",placeholder:"Name",disabled:B.length>0||$.length>0,onChange:function(e){return G(e.target.value)},value:A})}),Object(l.jsx)("hr",{}),I&&Object(l.jsx)("div",{children:Object(l.jsxs)("span",{children:["Waiting for connections. Share your session ID: ",x]})}),!I&&0===B.length&&Object(l.jsxs)(l.Fragment,{children:[Object(l.jsx)("div",{children:Object(l.jsx)("button",{disabled:""===A,onClick:function(){var e=new T.a;e.on("open",(function(n){console.log("Listening in session",n),z(!0),K([A]),D(n),e.on("connection",(function(e){console.log("Received connection!",e),_((function(n){return[].concat(Object(s.a)(n),[e])}))}))}))},children:"Host a session"})}),Object(l.jsx)("span",{children:"or"}),Object(l.jsxs)("div",{children:[Object(l.jsx)("input",{type:"text",placeholder:"Session id",value:x,onChange:function(e){return D(e.target.value)}}),Object(l.jsx)("button",{disabled:""===x||""===A,onClick:function(){console.log("trying to connect to",x);var e=new T.a;e.on("open",(function(n){console.log("I have ID",n);var t=e.connect(x.trim());_((function(e){return[].concat(Object(s.a)(e),[t])}))}))},children:"Join a session"})]})]})]})})})};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var z=function(e){e&&e instanceof Function&&t.e(3).then(t.bind(null,25)).then((function(n){var t=n.getCLS,c=n.getFID,r=n.getFCP,a=n.getLCP,o=n.getTTFB;t(e),c(e),r(e),a(e),o(e)}))};o.a.render(Object(l.jsx)(r.a.StrictMode,{children:Object(l.jsx)(I,{})}),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)})),z()}},[[22,1,2]]]);
//# sourceMappingURL=main.d9a096ae.chunk.js.map